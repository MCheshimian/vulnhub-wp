# 前言

都是虚拟机，采用桥接模式

靶机：`grotesque    192.168.1.41`   

攻击：`kali    192.168.1.16`

# 主机发现

使用`arp-scan -l`扫描

![](./pic-1/1.jpg)



# 信息收集

## 使用nmap扫描

这里是扫描全部端口，因为使用默认扫描的端口时，只有80端口，所以重新扫全部端口

![](./pic-1/2.jpg)



访问80端口网站，发现无资源

![](./pic-1/3.jpg)



访问66端口网站，这里列出了许多靶场等，不过这里有下载，下载看看是什么东西

![](./pic-1/4.jpg)

下载解压后，进入该文件夹内，文件很多，一个个的看，看能否发现关键

```shell
ls -Slh		以人类可读的方式按照文件大小，从大到小排序
ls -Slhr	从小到大
```



通过这个排序，看了众多的文件，最终在`_vvmlist`中找到一个文件`sense.md`

![](./pic-1/5.jpg)



这时候查看其中内容，有一个目录给出`lyricsblog`

![](./pic-1/6.jpg)

# 漏洞寻找

访问这个网站目录，注意，是在80端口上，一个`wordpress`博客

![](./pic-1/7.jpg)

使用专门的`wpscan`工具，检测博客

```
wpscan --url http://192.168.1.41/lyricsblog/
```

初步检测，发现`xmlrpc.php`，可能存在用户枚举及密码爆破

![](./pic-1/8.jpg)

尝试进行枚举

```
wpscan --url http://192.168.1.41/lyricsblog/ -e u -P [字典]
```

当然这里用户已经枚举出了`erdalkomurcu`。很长时间没有破解出，可能不是单纯的爆破，访问界面，查看源代码，发现注释的路径，访问查看

![](./pic-1/9.jpg)



访问图片，其中有些文字

![](./pic-1/10.jpg)



查看博客内容时，发现有一个标题涉及

![](./pic-1/11.jpg)

点击查看，应该是歌词之类的，翻译查看

![](./pic-1/12.jpg)

目前的信息就这么多，图片执行这个标题，内容。然后就是字典爆破，使用`cewl`爬取，不过也是没有。扫描一下目录试试

![](./pic-1/13.jpg)

# 漏洞利用

也是没有好的提示什么了，这里尝试了XSS及其他注入，还有`wpscan`插件主题漏洞都扫了，没有任何东西，不知道下一步怎么整了，网上看wp，都是说md5求和，就是把歌词放在文件求和，这个是真想不到啊，一点提示都没有

![](./pic-1/14.jpg)



这里注意，复制歌词后，其余的换行都删除，确保歌词从头到尾就是词，这里我登录的时候并没有提示什么，所以刚开始以为错了，后面看网上wp，原来是要字母大写，但是我没有提示

`BC78C6AB38E114D6135409E44F7CDDA2`

登录到系统中

![](./pic-1/15.jpg)



到这，靶场开始出问题了，直接断开，怎么办

![](./pic-1/16.jpg)



无奈，只能重装靶机，所以后面IP地址会变化，变成`192.168.1.42`

不过这次登录显示提示了，看来之前是玄学啊

![](./pic-1/17.jpg)

# 反弹shell

在主题编辑处，编辑`index.php`，在代码中加入`webshell`，然后更新即可

![](./pic-1/18.jpg)



也就是`/usr/share/webshells/php/php-reverse-shell.php`文件，在其中修改ip和端口即可

![](./pic-1/19.jpg)

kali开启监听，当浏览器访问`index.php`就会触发反弹`shell`

![](./pic-1/20.jpg)

# 提权

切换到网站目录`/var/www/html/lyricsblog`，查看配置文件`wp-config.php`

![](./pic-1/21.jpg)

获取到连接数据库的账户密码，测试该密码是否也是`ssh`的密码，不对，突然想到没有开放22端口，或ssh服务也没有扫到。使用`su`切换，可以，是其密码

![](./pic-1/22.jpg)



查看其家目录下的文件

![](./pic-1/23.jpg)

使用`nc`把这个`.chadroot.kdbx`下载到`kali`

![](./pic-1/24.jpg)

知道文件类型，借助`john`的套件，`keepass2john`转换成`john`可识别的内容，然后进行破解

![](./pic-1/25.jpg)

大概三分钟左右，密码出来`chatter` `chadroot`

![](./pic-1/26.jpg)

然后还需要解密，打开网站`app.keeweb.info`，在框内输入密码`chatter`，然后点击回车

![](./pic-1/27.jpg)



然后可以看到有的密码，进行测试

![](./pic-1/28.jpg)

最终在第三个测试成功

![](./pic-1/29.jpg)



# 清理痕迹

发现还有一个清空日志的脚本

![](./pic-1/30.jpg)

那这里直接运行这个脚本，进行清除痕迹

![](./pic-1/31.jpg)

# 总结

1. 对于端口等扫描，有时候可能把服务开启在并非是常见端口上
2. 对于信息收集，要全面，不要放过一个
3. 这里对于密码的整合，我其实不知道怎么总结，因为md5和去做密码，而且是把网站中的内容作为文件内容去求和。简单了解一下吧
4. 可能有的网站与数据库交互的密码，就是其本身的密码
5. `john`套件的强大，之前使用了`ssh2john`这次再加`keepass2john`
6. 对于`keepass`简单了解一下，知道怎么回事即可

















